{
  "platform_id": "union_eyes",
  "platform_name": "Union Eyes",
  "audit_date": "2026-02-17",
  "auditor": "Nzila Platform Analyzer V2",
  "version": "1.0.0",
  
  "executive_summary": {
    "total_entities": 4773,
    "codebase_size_mb": 332.81,
    "complexity_score": "EXTREME",
    "migration_estimate_weeks": "10-12",
    "critical_dependencies": [
      "drizzle-orm",
      "@clerk/nextjs",
      "bullmq",
      "ioredis",
      "stripe",
      "@tensorflow/tfjs"
    ],
    "migration_risks": [
      "130+ API routes need categorization and migration",
      "Complex RBAC with 55+ role types",
      "Real-time features using BullMQ jobs",
      "ML models using TensorFlow.js need retraining in Python",
      "238 RLS policies to migrate to Django permissions"
    ]
  },
  
  "schema_extraction": {
    "orm": "Drizzle ORM",
    "tables_count": 512,
    "tables": "See packages/automation/data/SCHEMA_EXTRACTION_REPORT.md section 2",
    "foreign_keys": "Extensive - see generated models",
    "indexes": "Auto-generated by Drizzle",
    "enums": [
      "organizationTypeEnum",
      "caJurisdictionEnum",
      "labourSectorEnum",
      "organizationStatusEnum",
      "membershipStatusEnum",
      "grievanceStatusEnum",
      "paymentMethodEnum",
      "and 30+ more"
    ],
    "rls_policies": [
      "238 RLS policies enforcing multi-tenant isolation"
    ],
    "generated_models_location": "packages/automation/data/generated/ue/",
    "status": "complete"
  },
  
  "api_inventory": {
    "total_routes": 130,
    "route_groups": [
      "app/api/organizations/*",
      "app/api/members/*",
      "app/api/grievances/*",
      "app/api/bargaining/*",
      "app/api/finance/*",
      "app/api/governance/*",
      "app/api/calendar/*",
      "app/api/documents/*",
      "app/api/analytics/*",
      "app/api/ai/*",
      "app/api/compliance/*",
      "app/api/notifications/*"
    ],
    "classification": {
      "backbone_shared": [
        "auth",
        "billing/stripe",
        "notifications",
        "analytics/events",
        "ai/chat",
        "compliance/audit"
      ],
      "product_specific": [
        "unions",
        "grievances",
        "bargaining",
        "strike-fund",
        "pension-processor",
        "insurance-adapter",
        "calendar",
        "elections",
        "cases",
        "governance",
        "trust"
      ],
      "legacy_to_remove": [
        "supabase auth routes (if any remaining)",
        "legacy Drizzle direct queries"
      ]
    },
    "rest_vs_graphql": {
      "rest_count": 130,
      "graphql_count": 0,
      "trpc_count": 0
    }
  },
  
  "auth_flow_mapping": {
    "current_provider": "Clerk",
    "auth_methods": [
      "Email + Password",
      "Magic Link",
      "OAuth (Google, Microsoft)",
      "SAML (enterprise)"
    ],
    "rbac_implementation": {
      "has_roles": true,
      "has_permissions": true,
      "role_count": 55,
      "permission_count": 238,
      "notes": "Custom RBAC built on Clerk metadata + Drizzle roles table"
    },
    "sso_integrations": [
      "Microsoft Entra ID (for enterprise unions)",
      "Google Workspace"
    ],
    "migration_plan": {
      "target_provider": "clerk",
      "complexity": "LOW",
      "estimated_hours": 8,
      "risks": [
        "Already on Clerk - just need to move RBAC logic to Django backend"
      ]
    }
  },
  
  "service_dependencies": {
    "npm_packages": {
      "total": "Needs analysis with legacy codebase access",
      "production": "TBD",
      "dev": "TBD",
      "backbone_shared": [
        "@clerk/nextjs",
        "stripe",
        "@sentry/nextjs",
        "react-email",
        "resend"
      ],
      "product_specific": [
        "@tensorflow/tfjs (pension forecasting)",
        "Chart.js (analytics)",
        "PDF generation libraries"
      ],
      "to_remove": [
        "drizzle-orm",
        "drizzle-kit",
        "any remaining @supabase/* packages"
      ],
      "to_migrate": [
        "bullmq → celery",
        "ioredis → redis-py",
        "@clerk/backend → clerk-backend-api (Python)",
        "stripe → stripe-python"
      ]
    },
    "external_apis": [
      "Stripe API",
      "Clerk Management API",
      "Azure OpenAI",
      "Resend email API",
      "CRA/Revenue Canada APIs (tax/pension data)",
      "Provincial Labour Relations Board APIs"
    ],
    "cloud_services": [
      "Azure PostgreSQL",
      "Azure Blob Storage (documents)",
      "Azure CDN",
      "Azure Container Apps (target)",
      "Azure Redis Cache"
    ]
  },
  
  "queue_worker_inventory": {
    "has_queues": true,
    "queue_technology": "BullMQ + ioredis",
    "job_types": [
      "pension_calculation",
      "ml_model_prediction",
      "document_processing",
      "email_delivery",
      "analytics_aggregation",
      "strike_fund_distribution",
      "insurance_sync"
    ],
    "cron_jobs": [
      "Daily pension rate updates",
      "Weekly CBA expiry reminders",
      "Monthly financial reports",
      "Quarterly compliance audits"
    ],
    "migration_target": "celery with celery-beat for cron"
  },
  
  "ai_ml_pipeline": {
    "has_ai": true,
    "llm_providers": [
      "Azure OpenAI (GPT-4)"
    ],
    "model_types": [
      "TensorFlow.js — Pension forecasting",
      "TensorFlow.js — Grievance outcome prediction",
      "TensorFlow.js — Member churn prediction",
      "GPT-4 — CBA intelligence & analysis",
      "GPT-4 — Grievance auto-response suggestions"
    ],
    "features": [
      "AI Companion (chat interface)",
      "Pension amount prediction",
      "Grievance outcome likelihood",
      "CBA clause extraction & summarization",
      "Member engagement scoring"
    ],
    "vector_db": "Azure Cosmos DB for MongoDB vCore (planned)",
    "embeddings": "Azure OpenAI text-embedding-ada-002",
    "cost_estimate_monthly": 800
  },
  
  "compliance_inventory": {
    "frameworks": [
      "PCI DSS (Stripe integration)",
      "SOC 2 Type II (target)",
      "ISO 27001 (target)",
      "Canadian privacy laws (PIPEDA)"
    ],
    "audit_logging": true,
    "data_retention": true,
    "encryption_at_rest": true,
    "encryption_in_transit": true,
    "pci_compliant": true,
    "hipaa_compliant": false,
    "gdpr_compliant": true,
    "required_migrations": [
      "Move audit logs to Django audit framework",
      "Centralize compliance policies in backbone"
    ]
  },
  
  "code_quality": {
    "typescript_coverage": 95,
    "test_coverage": 45,
    "linting_configured": true,
    "formatting_configured": true,
    "ci_cd_present": false,
    "security_scan_present": false
  },
  
  "migration_roadmap": {
    "phase_1_audit": {
      "status": "complete",
      "estimated_hours": 40
    },
    "phase_2_backend_migration": {
      "status": "in_progress",
      "estimated_hours": 200,
      "tasks": [
        "Generate Django models from Drizzle schemas ✅",
        "Create DRF serializers, views, URLs ✅",
        "Migrate BullMQ jobs to Celery",
        "Migrate TensorFlow.js models to scikit-learn/PyTorch",
        "Set up Clerk backend integration",
        "Implement Django RBAC system"
      ]
    },
    "phase_3_frontend_refactor": {
      "status": "not_started",
      "estimated_hours": 120,
      "tasks": [
        "Remove Drizzle client calls",
        "Replace with Backbone API client",
        "Update auth flows to use backend session",
        "Refactor components to use new API structure"
      ]
    },
    "phase_4_testing": {
      "status": "not_started",
      "estimated_hours": 80,
      "tasks": [
        "Write Django unit tests",
        "Write API integration tests",
        "E2E tests with Playwright",
        "Load testing with Locust"
      ]
    },
    "phase_5_deployment": {
      "status": "not_started",
      "estimated_hours": 60,
      "tasks": [
        "Bicep infrastructure templates",
        "GitHub Actions CI/CD",
        "Staging environment setup",
        "Production deployment",
        "Migration scripts",
        "Monitoring & alerting"
      ]
    }
  },
  
  "blockers": [
    "Legacy codebase not accessible in current workspace - need to analyze API routes manually",
    "ML model retraining requires data export from production database",
    "BullMQ job migration requires understanding of all queue consumers"
  ],
  
  "recommendations": [
    "Prioritize Celery migration for background jobs",
    "Set up Django admin for union staff to manage data",
    "Implement comprehensive API documentation with drf-spectacular",
    "Create data migration scripts for production cutover",
    "Set up staging environment mirroring production",
    "Implement feature flags for gradual rollout"
  ],
  
  "next_steps": [
    "Access legacy Union Eyes codebase to analyze API routes in detail",
    "Run dependency analyzer on actual codebase",
    "Map all BullMQ jobs to Celery tasks",
    "Create ML model migration plan (TF.js → Python)",
    "Set up new nzila-union-eyes repository",
    "Populate scaffold with Django backend + Next.js frontend",
    "Begin Celery worker implementation"
  ]
}
